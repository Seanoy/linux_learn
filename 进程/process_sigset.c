#include <unistd.h>
#include <signal.h>
#include <sys/types.h>
#include <stdlib.h>
#include <stdio.h>

void handler(int sig)
{
	printf("\nsignal trigged %d\n", sig);
}

int main(int argc, char* argv[])
{
	sigset_t sigset;//记录屏蔽字 mask
    sigset_t ign;//用于记录被阻塞的信号集  blocked
	
	struct sigaction act;//信号动作
	
	//清空信号集  
    sigemptyset(&sigset);  //初始化信号集
    sigemptyset(&ign); 

    //向信号集中添加信号SIGINT  
    sigaddset(&sigset, SIGINT);

	//设置处理函数和信号集
	act.sa_handler = handler;
	sigemptyset(&act.sa_mask);
	act.sa_flags = 0;
	sigaction(SIGINT, &act, 0);
	
    printf("Wait the signal SIGINT...\n");  
    pause();//挂起进程，等待信号  

    //设置进程屏蔽字，在本例中为屏蔽SIGINT
	sigprocmask(SIG_SETMASK, &sigset, 0);
    printf("Please press Ctrl+c within 10 seconds...\n");  
    sleep(10); 
	
    //测试SIGINT是否被屏蔽  
    sigpending(&ign);  
	
    if(sigismember(&ign, SIGINT))  
        printf("The SIGINT signal has ignored\n"); 
	
    //在信号集中删除信号SIGINT  
    sigdelset(&sigset, SIGINT);  
    printf("Wait the signal SIGINT...\n"); 
	
    //将进程的屏蔽字重新设置，即取消对SIGINT的屏蔽  
    //并挂起进程  
    sigsuspend(&sigset);  
  
    printf("The app will exit in 5 seconds!\n");  
    sleep(5);  
    exit(0);  
}
